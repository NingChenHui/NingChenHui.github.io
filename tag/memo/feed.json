{
    "version": "https://jsonfeed.org/version/1",
    "title": "欢迎 • All posts by \"memo\" tag",
    "description": "DESS, THU",
    "home_page_url": "https://ningchenhui.github.io",
    "items": [
        {
            "id": "https://ningchenhui.github.io/ESM/OMARE/CoarsenOperator/",
            "url": "https://ningchenhui.github.io/ESM/OMARE/CoarsenOperator/",
            "title": "OMARE 粗化算子",
            "date_published": "2022-06-22T10:47:52.000Z",
            "content_html": "<p>OMARE CoarsenOperator <span id=\"more\"></span></p>\n<h1 id=\"新增自定义插值算子\"><a class=\"markdownIt-Anchor\" href=\"#新增自定义插值算子\">#</a> 新增自定义插值算子</h1>\n<p>参考  <code>NemoSpaceInterpCenter.h</code>  中的实现。</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"><span>NemoSpaceMeanCenter.h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">NemoSpaceMeanCenter</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> xfer<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">CoarsenOperator</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">NDIM</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token function\">NemoSpaceMeanCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\td_name_id <span class=\"token operator\">=</span> <span class=\"token string\">\"NEMO_MEAN_INTERP\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\talpha <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//TODO 粗化时细网格值的权重</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   * @brief 在指定的粗网格内，</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   * 将细网格片上指定的数据片插值到粗网格片上指定的数据片上.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   * @param fine 输入参数，Patch 类，表示细网格片.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   * @param coarse 输入参数，Patch 类，表示粗网格片.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   * @param dst_component 输入参数，整型，表示目的数据片.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   * @param src_component 输入参数，整型，表示源数据片.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   * @param  coarse_box 输入参数，Box 类，表示粗化网格.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   * @param ratio 输入参数，整型向量类，表示粗化比率.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token keyword\">void</span> <span class=\"token function\">coarsen</span><span class=\"token punctuation\">(</span>hier<span class=\"token double-colon punctuation\">::</span>Patch<span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> coarse<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> hier<span class=\"token double-colon punctuation\">::</span>Patch<span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> fine<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>               <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> dst_component<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> src_component<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>               <span class=\"token keyword\">const</span> hier<span class=\"token double-colon punctuation\">::</span>Box<span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> coarse_box<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>               <span class=\"token keyword\">const</span> hier<span class=\"token double-colon punctuation\">::</span>IntVector<span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> ratio<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">const</span> hier<span class=\"token double-colon punctuation\">::</span>Box<span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">></span> fine_box <span class=\"token operator\">=</span> hier<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">Box</span><span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">></span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">refine</span><span class=\"token punctuation\">(</span>coarse_box<span class=\"token punctuation\">,</span> ratio<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"><span>NemoFort.h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">extern</span> <span class=\"token keyword\">void</span> <span class=\"token function\">space_mean_center_</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> ir00<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jr00<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> ic00<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jc00<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                            <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> ir0<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jr0<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> ir1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jr1<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                            <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> ic0<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jc0<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> ic1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jc1<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                            <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jpir<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jpjr<span class=\"token punctuation\">,</span> <span class=\"token keyword\">double</span><span class=\"token operator\">*</span> ur<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                            <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jpic<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> jpjc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">double</span><span class=\"token operator\">*</span> uc<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                            <span class=\"token keyword\">int</span><span class=\"token operator\">*</span> ratio<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"fortran-实现\"><a class=\"markdownIt-Anchor\" href=\"#fortran-实现\">#</a> Fortran 实现</h1>\n<figure class=\"highlight fortran\"><figcaption data-lang=\"fortran\"><span>JASMIN_FILLGHOST.F90</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">SUBROUTINE</span> space_mean_center<span class=\"token punctuation\">(</span> ir00<span class=\"token punctuation\">,</span> jr00<span class=\"token punctuation\">,</span> ic00<span class=\"token punctuation\">,</span> jc00<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                                ir0<span class=\"token punctuation\">,</span> jr0<span class=\"token punctuation\">,</span> ir1<span class=\"token punctuation\">,</span> jr1<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&amp;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                                ic0<span class=\"token punctuation\">,</span> jc0<span class=\"token punctuation\">,</span> ic1<span class=\"token punctuation\">,</span> jc1<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&amp;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                                jpir<span class=\"token punctuation\">,</span> jpjr<span class=\"token punctuation\">,</span> uf<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&amp;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                                jpic<span class=\"token punctuation\">,</span> jpjc<span class=\"token punctuation\">,</span> uc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&amp;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                ratio<span class=\"token punctuation\">)</span> bind<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token string\">\"space_mean_center_\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">! input &amp; output            </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">INTEGER</span><span class=\"token punctuation\">,</span>                        <span class=\"token keyword\">INTENT</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span>   ir00<span class=\"token punctuation\">,</span> jr00<span class=\"token punctuation\">,</span> ic00<span class=\"token punctuation\">,</span> jc00      <span class=\"token comment\">!patch lower index (ghost included)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">INTEGER</span><span class=\"token punctuation\">,</span>                        <span class=\"token keyword\">INTENT</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span>   ir0<span class=\"token punctuation\">,</span> jr0<span class=\"token punctuation\">,</span> ir1<span class=\"token punctuation\">,</span> jr1          <span class=\"token comment\">!refine box start/end index</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">INTEGER</span><span class=\"token punctuation\">,</span>                        <span class=\"token keyword\">INTENT</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span>   ic0<span class=\"token punctuation\">,</span> jc0<span class=\"token punctuation\">,</span> ic1<span class=\"token punctuation\">,</span> jc1          <span class=\"token comment\">!coarse box start/end index</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">INTEGER</span><span class=\"token punctuation\">,</span>                        <span class=\"token keyword\">INTENT</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span>   jpir<span class=\"token punctuation\">,</span> jpjr                  <span class=\"token comment\">!refine patch size (ghost included)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">REAL</span><span class=\"token punctuation\">(</span>wp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">DIMENSION</span><span class=\"token punctuation\">(</span>jpir<span class=\"token punctuation\">,</span>jpjr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">INTENT</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span>   uf                          <span class=\"token comment\">!refine patch data</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">INTEGER</span><span class=\"token punctuation\">,</span>                        <span class=\"token keyword\">INTENT</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span>   jpic<span class=\"token punctuation\">,</span> jpjc                  <span class=\"token comment\">!coarse patch size (ghost included)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">REAL</span><span class=\"token punctuation\">(</span>wp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">DIMENSION</span><span class=\"token punctuation\">(</span>jpic<span class=\"token punctuation\">,</span>jpjc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">INTENT</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">inout</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span>   uc                       <span class=\"token comment\">!coarse patch data</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">INTEGER</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">DIMENSION</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>         <span class=\"token keyword\">INTENT</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span>   ratio                       <span class=\"token comment\">!x refinement ratio NDIM?</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">! local</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">INTEGER</span> <span class=\"token operator\">::</span> ic<span class=\"token punctuation\">,</span> jc</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">INTEGER</span> <span class=\"token operator\">::</span> ic_loc<span class=\"token punctuation\">,</span> jc_loc</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">REAL</span><span class=\"token punctuation\">(</span>wp<span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span> sum_</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">DO</span> jc <span class=\"token operator\">=</span> jc0<span class=\"token punctuation\">,</span> jc1</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">DO</span> ic <span class=\"token operator\">=</span> ic0<span class=\"token punctuation\">,</span> ic1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        sum_ <span class=\"token operator\">=</span> SUM<span class=\"token punctuation\">(</span>uf<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ic<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>ratio<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span>ir00<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span>ic<span class=\"token operator\">*</span>ratio<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span>ir00<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>jc<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>ratio<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span>jr00<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span>jc<span class=\"token operator\">*</span>ratio<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span>jr00<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">! coarse local index</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        ic_loc <span class=\"token operator\">=</span> ic <span class=\"token operator\">-</span> ic00 <span class=\"token operator\">+</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        jc_loc <span class=\"token operator\">=</span> jc <span class=\"token operator\">-</span> jc00 <span class=\"token operator\">+</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        uc<span class=\"token punctuation\">(</span>ic_loc<span class=\"token punctuation\">,</span> jc_loc<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> sum_ <span class=\"token operator\">/</span> <span class=\"token keyword\">REAL</span><span class=\"token punctuation\">(</span>ratio<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>ratio<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>wp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">ENDDO</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">ENDDO</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">END SUBROUTINE</span> space_mean_center</pre></td></tr></table></figure><h1 id=\"启用-overlay\"><a class=\"markdownIt-Anchor\" href=\"#启用-overlay\">#</a> 启用 Overlay</h1>\n<p>这里  <code>sync_time % 1 != 0</code>  的  <code>1</code>  改为 Overlay 的步长。</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>NemoLevelIntegrator_body.C Producer.py</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/****************************************************************</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * AMR, 同步粗网格层.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *****************************************************************/</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">void</span> NemoLevelIntegrator<span class=\"token operator\">::</span><span class=\"token function\">synchronizeCoarserLevel</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">const</span> JASMIN<span class=\"token operator\">::</span>tbox<span class=\"token operator\">::</span>Pointer<span class=\"token operator\">&lt;</span>JASMIN<span class=\"token operator\">::</span>hier<span class=\"token operator\">::</span>BasePatchHierarchy<span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">>></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    hierarchy<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> finer_level_number<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">double</span> sync_time<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">double</span> coarser_old_time<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  using namespace std<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  using namespace JASMIN<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>sync_time <span class=\"token operator\">%</span> <span class=\"token number\">1</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  tbox<span class=\"token operator\">::</span>pout<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">\"***********************************************\"</span><span class=\"token operator\">&lt;&lt;</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  tbox<span class=\"token operator\">::</span>pout<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">\"Synchronize (Overlay) Coarser Level... \"</span><span class=\"token operator\">&lt;&lt;</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  tbox<span class=\"token operator\">::</span>pout<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">\"     finer_level_number==\"</span><span class=\"token operator\">&lt;&lt;</span>finer_level_number<span class=\"token operator\">&lt;&lt;</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  tbox<span class=\"token operator\">::</span>pout<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">\"     sync_time==\"</span><span class=\"token operator\">&lt;&lt;</span>sync_time<span class=\"token operator\">&lt;&lt;</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  tbox<span class=\"token operator\">::</span>pout<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">\"     coarser_old_time==\"</span><span class=\"token operator\">&lt;&lt;</span>coarser_old_time<span class=\"token operator\">&lt;&lt;</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  tbox<span class=\"token operator\">::</span>pout<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">\"***********************************************\"</span><span class=\"token operator\">&lt;&lt;</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token comment\">// 校正相邻粗网格层的通量</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  tbox<span class=\"token operator\">::</span>Pointer<span class=\"token operator\">&lt;</span>hier<span class=\"token operator\">::</span>PatchLevel<span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">>></span> finer_level <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    hierarchy<span class=\"token operator\">-></span><span class=\"token function\">getPatchLevel</span><span class=\"token punctuation\">(</span>finer_level_number<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  tbox<span class=\"token operator\">::</span>Pointer<span class=\"token operator\">&lt;</span>hier<span class=\"token operator\">::</span>PatchLevel<span class=\"token operator\">&lt;</span>NDIM<span class=\"token operator\">>></span> coarser_level <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    hierarchy<span class=\"token operator\">-></span><span class=\"token function\">getPatchLevel</span><span class=\"token punctuation\">(</span>finer_level_number <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">double</span> actual_dt <span class=\"token operator\">=</span> sync_time <span class=\"token operator\">-</span> coarser_old_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token comment\">// 细网格 -> 粗网格 (具体方法在初始化构件中)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  sync_overlay_intc<span class=\"token operator\">-></span><span class=\"token function\">synchronizeCoarserLevel</span><span class=\"token punctuation\">(</span>finer_level<span class=\"token punctuation\">,</span> sync_time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"注册使用插值算子的变量\"><a class=\"markdownIt-Anchor\" href=\"#注册使用插值算子的变量\">#</a> 注册使用插值算子的变量</h1>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"><span>Producer.py var_db.py</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>OVERLAY_DOUBLE_INTERP_CENTER <span class=\"token operator\">=</span> <span class=\"token string\">\"NEMO_MEAN_INTERP\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>t_field_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string\">\"tsn\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"tsb\"</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">\"sshn\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sshb\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token string\">\"avm_k\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Overlayregister.h\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"w\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\"># T</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token keyword\">for</span> field <span class=\"token keyword\">in</span> t_field_list<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        f<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">\"intc->registerCoarsenPatchData(manager->\"</span><span class=\"token operator\">+</span>field<span class=\"token operator\">+</span><span class=\"token string\">\"_id,\\n\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        f<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">\"                        \\\"\"</span><span class=\"token operator\">+</span>OVERLAY_DOUBLE_INTERP_CENTER<span class=\"token operator\">+</span><span class=\"token string\">\"\\\",\\n\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        f<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">\"                        manager->\"</span><span class=\"token operator\">+</span>field<span class=\"token operator\">+</span><span class=\"token string\">\"_id);\\n\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>main_Nemo.C</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"NemoSpaceMeanCenter.h\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// add user-define sapce refine operator</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tbox<span class=\"token operator\">::</span>Pointer<span class=\"token operator\">&lt;</span>JASMIN<span class=\"token operator\">::</span>pdat<span class=\"token operator\">::</span>NemoSpaceMeanCenter<span class=\"token operator\">></span> nemo_space_mean_center_operator</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token operator\">=</span> new JASMIN<span class=\"token operator\">::</span>pdat<span class=\"token operator\">::</span><span class=\"token function\">NemoSpaceMeanCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>grid_geometry<span class=\"token operator\">-></span><span class=\"token function\">addSpatialCoarsenOperator</span><span class=\"token punctuation\">(</span>nemo_space_mean_center_operator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"与-conservative_coarsen-比较\"><a class=\"markdownIt-Anchor\" href=\"#与-conservative_coarsen-比较\">#</a> 与 “CONSERVATIVE_COARSEN” 比较</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>h5diff omare_mean/build/exp_l2/javis_dump.00006/processor_cluster.00000.jasmin omare_220608/build/exp_l2/javis_dump.00006/processor_cluster.00000.jasmin</pre></td></tr></table></figure><pre><code>size:           [2400]           [2400]\nposition        sshn            sshn            difference          \n------------------------------------------------------------\n[ 900 ]          6.04414e-07     6.04414e-07     5.68434e-14    \n1 differences found\ndataset: &lt;/processor.00000/level.00001/patch.00000/un.38&gt; and &lt;/processor.00000/level.00001/patch.00000/un.38&gt;\nsize:           [15000]           [15000]\nposition        un.38           un.38           difference          \n------------------------------------------------------------\n[ 145 ]          -1.00591e-05    -1.00591e-05    9.09495e-13    \n[ 210 ]          -1.2723e-06     -1.2723e-06     1.13687e-13    \n[ 1985 ]          -8.53e-07       -8.53e-07       5.68434e-14    \n[ 2438 ]          -1.50793e-05    -1.50793e-05    9.09495e-13    \n</code></pre>\n<p>加上  <code>1e-10</code>  的限制后只有 14 个差异值。</p>\n<h2 id=\"sshn\"><a class=\"markdownIt-Anchor\" href=\"#sshn\">#</a> sshn</h2>\n<p class=\"gallery\" data-height=\"400\"><img data-src=\"0608.png\" alt=\"\" title=\"jasmin\"><br>\n<img data-src=\"mean.png\" alt=\"mean\"><br>\n<img data-src=\"bug.png\" alt=\"赋0\"></p>\n",
            "tags": [
                "Memo",
                "Coding"
            ]
        },
        {
            "id": "https://ningchenhui.github.io/ESM/NEMO/install/",
            "url": "https://ningchenhui.github.io/ESM/NEMO/install/",
            "title": "Install NEMO notes",
            "date_published": "2022-05-01T15:19:13.000Z",
            "content_html": "<p>NEMO 安装<span id=\"more\"></span></p>\n<h1 id=\"prerequisites\"><a class=\"markdownIt-Anchor\" href=\"#prerequisites\">#</a> Prerequisites</h1>\n<div class=\"note info\">\n<p>Suggestion from J Mak<sup>[4]</sup>:<br>\nGet someone who knows what they are doing to do it for you! Compiling the following from scratch is not the most interesting activity and is actually quite fiddly (especially the HDF5 and NetCDF4 stuff)…if you don’t have access to people who can do that, then try.</p>\n</div>\n<p>Before installing these, run  <code>which h5copy</code>  and  <code>which nc-config</code>  to see if hdf5 and netcdf are already available. If so, we can skip installing them and zlib.</p>\n<h2 id=\"zlib\"><a class=\"markdownIt-Anchor\" href=\"#zlib\">#</a> zlib</h2>\n<p>When I was trying to install Netcdf, I found this requirement in its  <code>INSTALL.md</code>  file. After downloading packages from <span class=\"exturl\" data-url=\"ZnRwOi8vZnRwLnVuaWRhdGEudWNhci5lZHUvcHViL25ldGNkZi9uZXRjZGYtNA==\">server</span>, build it like:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./configure --prefix<span class=\"token operator\">=</span>/home/user/study/software/zlib</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">make</span> check <span class=\"token function\">install</span></pre></td></tr></table></figure><h2 id=\"hdf5\"><a class=\"markdownIt-Anchor\" href=\"#hdf5\">#</a> hdf5</h2>\n<p>Specifying the location of the zlib library:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">CC</span><span class=\"token operator\">=</span>/usr/local/mpich-3.1/bin/mpicc ./configure --with-zlib<span class=\"token operator\">=</span>/home/user/study/software/zlib --prefix<span class=\"token operator\">=</span>/home/user/study/software/hdf5 --<span class=\"token punctuation\">&#123;</span>enable-fortran,disable-shared,enable-parallel<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">make</span> check <span class=\"token function\">install</span></pre></td></tr></table></figure><p>I just add  <code>[--&#123;enable-fortran,disable-shared,enable-parallel&#125;]</code>  from offical documentation of NEMO<sup>[1]</sup>, but it may bring some problems.</p>\n<h2 id=\"netcdf\"><a class=\"markdownIt-Anchor\" href=\"#netcdf\">#</a> netcdf</h2>\n<p>After HDF5 is done, build netcdf, specifying the location of the HDF5, zlib, and<br>\nlibraries in the CPPFLAGS and LDFLAGS environment variables. For example:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">CC</span><span class=\"token operator\">=</span>mpicc <span class=\"token assign-left variable\">CPPFLAGS</span><span class=\"token operator\">=</span>-I/home/user/study/software/hdf5/include <span class=\"token assign-left variable\">LDFLAGS</span><span class=\"token operator\">=</span>-L/home/user/study/software/hdf5/lib <span class=\"token assign-left variable\">LD_LIBRARY_PATH</span><span class=\"token operator\">=</span>/home/user/study/software/hdf5/lib:/home/user/study/software/zlib/lib ./configure --prefix<span class=\"token operator\">=</span>/home/user/study/software/netcdf-c-p --<span class=\"token punctuation\">&#123;</span>enable-fortran,disable-shared,enable-parallel,enable-parallel-tests<span class=\"token punctuation\">&#125;</span> --enable-netcdf4</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">make</span> check <span class=\"token function\">install</span></pre></td></tr></table></figure><p>You can check the output or setting file in  <code>lib</code>  to see whether parallel IO is on.</p>\n<p>Then build netcdf-fortran like:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">CC</span><span class=\"token operator\">=</span>mpicc <span class=\"token assign-left variable\">FC</span><span class=\"token operator\">=</span>mpif90 <span class=\"token assign-left variable\">F77</span><span class=\"token operator\">=</span>mpif77 <span class=\"token assign-left variable\">CPPFLAGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-I/home/user/study/software/netcdf-c-p/include -I/home/user/study/software/hdf5/include -I/home/user/study/software/zlib/include\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">LDFLAGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-L/home/user/study/software/netcdf-c-p/lib -L/home/user/study/software/hdf5/lib -L/home/user/study/software/zlib/lib\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">LD_LIBRARY_PATH</span><span class=\"token operator\">=</span>/home/user/study/software/netcdf-c-p/lib:/home/user/study/software/hdf5/lib:/home/user/study/software/zlib/lib <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">LIBS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-lnetcdf -lhdf5_hl -lhdf5 -lz -lcurl\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>./configure --disable-shared --prefix<span class=\"token operator\">=</span>/home/user/study/software/netcdf-f-p</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">make</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">make</span> check</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">make</span> <span class=\"token function\">install</span></pre></td></tr></table></figure><h2 id=\"ncview\"><a class=\"markdownIt-Anchor\" href=\"#ncview\">#</a> ncview</h2>\n<p>It is not necessary, but it’s a easy tool to check the nc file.</p>\n<p>First install Xaw using  <code>sudo yum install libXaw-devel</code> .<br>\nThen just following [6].</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./configure --prefix<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/ncview/ --with-udunits2_incdir<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/udunits/include/ --with-udunits2_libdir<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/udunits/lib/ --with-png_incdir<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/libpng/include/ --with-png_libdir<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/libpng/lib/</pre></td></tr></table></figure><h2 id=\"xios\"><a class=\"markdownIt-Anchor\" href=\"#xios\">#</a> XIOS</h2>\n<p>Refer to wiki<sup>[2]</sup> and J Mak’s notes<sup>[4]</sup>, first</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>svn checkout -r <span class=\"token number\">1566</span> http://forge.ipsl.jussieu.fr/ioserver/svn/XIOS/branchs/xios-2.5 xios-2.5</pre></td></tr></table></figure><p>NEMO has requirements for the XIOS version, remember to check that.</p>\n<p>Then modify files  <code>arch-GCC_LINUX.*</code>  in  <code>arch</code> , add the  <code>-ldl</code>  flag to  <code>HDF5_LIB</code>  in  <code>arch-GCC_local.path</code>  since we build hdf5 library as a not shareable.</p>\n<p>The  <code>boost_dir</code>  and  <code>OASIS_dir</code>  are not necessary, just leave them.</p>\n<p>Finally, run</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./make_xios --arch GCC_LINUX</pre></td></tr></table></figure><h1 id=\"nemo\"><a class=\"markdownIt-Anchor\" href=\"#nemo\">#</a> NEMO</h1>\n<p>Copy and rename an configuration file from an architecture similar to our own. Set the following variables:</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>%NCDF_HOME    &#x2F;usr&#x2F;local&#x2F;path&#x2F;to&#x2F;netcdf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>%HDF5_HOME    &#x2F;usr&#x2F;local&#x2F;path&#x2F;to&#x2F;hdf5</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>%XIOS_HOME    &#x2F;home&#x2F;$( whoami )&#x2F;path&#x2F;to&#x2F;xios-trunk</pre></td></tr></table></figure><p>Compile a reference configuration:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./makenemo –m <span class=\"token string\">'my_arch'</span> –r GYRE_PISCES</pre></td></tr></table></figure><p>And find  <code>nemo</code>  in  <code>cfgs/GYRE_PISCES/EXP00</code> .</p>\n<h1 id=\"good-luck\"><a class=\"markdownIt-Anchor\" href=\"#good-luck\">#</a> Good luck!</h1>\n<p>Hope you can find nemo soon.</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>._      ._      ._      ._      ._    </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  _.-._)&#96;\\_.-._)&#96;\\_.-._)&#96;\\_.-._)&#96;\\_.-._)&#96;\\_ </pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      o         _,           _,             </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        o      .&#39; (        .-&#39; &#x2F;             </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      o     _&#x2F;..._&#39;.    .&#39;   &#x2F;              </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  (    o .-&#39;&#96;      &#96; &#39;-.&#x2F;  _.&#39;               </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  )    ( o)           ;&#x3D; &lt;_         (       </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  (      &#39;-.,\\\\__ __.-;&#96;\\   &#39;.        )      </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  )  )       \\) |&#96;\\ \\)  &#39;.   \\      (   (   </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  (  (           \\_&#x2F;       &#39;-._\\      )   )  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  )  ) jgs                     &#96;    (   (   </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</pre></td></tr></table></figure><h1 id=\"reference\"><a class=\"markdownIt-Anchor\" href=\"#reference\">#</a> Reference</h1>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaXRlcy5uZW1vLW9jZWFuLmlvL3VzZXItZ3VpZGUvaW5zdGFsbC5odG1s\">NEMO documentation</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb3JnZS5pcHNsLmp1c3NpZXUuZnIvaW9zZXJ2ZXIvd2lraS9kb2N1bWVudGF0aW9u\">XIOS wiki</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaWNsb3VkLmNvbS9wcnRnLWt1bnBlbmdocGNzL2t1bnBlbmduZW1vXzAyXzAwMDEuaHRtbA==\">Kunpeng NEMO transplant</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZW1vLXJlbGF0ZWQucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2NvbXBpbGF0aW9uX25vdGVzL25lbW8zNi5odG1s\">J Mak NEMO notes</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96ZW5vZG8ub3JnL3JlY29yZC8zMzg2MzEwIy5ZbTEwNUpKQnhRSQ==\">NEMO Reference configurations inputs</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xNDcxMzM4\">NCVIEW installation</span></li>\n</ol>\n",
            "tags": [
                "Memo",
                "Coding"
            ]
        },
        {
            "id": "https://ningchenhui.github.io/ESM/OMARE/omare220205/",
            "url": "https://ningchenhui.github.io/ESM/OMARE/omare220205/",
            "title": "OMARE 学习使用（一）",
            "date_published": "2022-02-05T11:19:13.000Z",
            "content_html": "<p>Learn to run OMARE（i）<span id=\"more\"></span></p>\n<p>step 1 - 解压源代码后，在目录里创建  <code>build</code>  文件夹<br>\n step 2 - 修改文件中的路径</p>\n<pre><code>a. CMakeLists.txt\n  set(JASMIN_VERSION 新路径)\nb. input/GYRE/namelist_cfg (之后可以在build中改)\n  nn_GYRE  resolution\n</code></pre>\n<p>step 3 - 进入  <code>build</code>  文件夹，执行  <code>~/jasmin4/bin/cmake ../</code> <br>\nstep 4 - 执行  <code>make</code>  ( <code>make -j 50</code>  多线程)<br>\nstep 5 -  <code>./main2d ../input/nemo-2d.input</code>   运行不完 / 测试时可  <code>ctrl+c</code>  中止<br>\n step 6 -  <code>ctrl+r</code>   <code>teravap</code>  查看数据 （ <code>/usr/local/teravap/teravap2_2_0.linux- x86_64/bin/teravap</code> ）<br>\n         数据在  <code>./build/javis../dumps.javis</code>  中，打开后 Add - Mesh , Draw。更换数据需要重启。</p>\n<p>修改完 h 文件后执行 step 4</p>\n<p>虚拟机 mpi 运行</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mpirun -n <span class=\"token number\">4</span> ./main2d <span class=\"token punctuation\">..</span>/input/nemo-2d.input</pre></td></tr></table></figure>",
            "tags": [
                "Memo",
                "Coding"
            ]
        }
    ]
}