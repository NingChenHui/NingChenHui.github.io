{
    "version": "https://jsonfeed.org/version/1",
    "title": "欢迎 • All posts by \"nemo\" category",
    "description": "DESS, THU",
    "home_page_url": "https://ningchenhui.github.io",
    "items": [
        {
            "id": "https://ningchenhui.github.io/ESM/NEMO/install/",
            "url": "https://ningchenhui.github.io/ESM/NEMO/install/",
            "title": "Install NEMO notes",
            "date_published": "2022-05-01T15:19:13.000Z",
            "content_html": "<p>NEMO 安装<span id=\"more\"></span></p>\n<h1 id=\"prerequisites\"><a class=\"markdownIt-Anchor\" href=\"#prerequisites\">#</a> Prerequisites</h1>\n<div class=\"note info\">\n<p>Suggestion from J Mak<sup>[4]</sup>:<br>\nGet someone who knows what they are doing to do it for you! Compiling the following from scratch is not the most interesting activity and is actually quite fiddly (especially the HDF5 and NetCDF4 stuff)…if you don’t have access to people who can do that, then try.</p>\n</div>\n<p>Before installing these, run  <code>which h5copy</code>  and  <code>which nc-config</code>  to see if hdf5 and netcdf are already available. If so, we can skip installing them and zlib.</p>\n<h2 id=\"zlib\"><a class=\"markdownIt-Anchor\" href=\"#zlib\">#</a> zlib</h2>\n<p>When I was trying to install Netcdf, I found this requirement in its  <code>INSTALL.md</code>  file. After downloading packages from <span class=\"exturl\" data-url=\"ZnRwOi8vZnRwLnVuaWRhdGEudWNhci5lZHUvcHViL25ldGNkZi9uZXRjZGYtNA==\">server</span>, build it like:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./configure --prefix<span class=\"token operator\">=</span>/home/user/study/software/zlib</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">make</span> check <span class=\"token function\">install</span></pre></td></tr></table></figure><h2 id=\"hdf5\"><a class=\"markdownIt-Anchor\" href=\"#hdf5\">#</a> hdf5</h2>\n<p>Specifying the location of the zlib library:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">CC</span><span class=\"token operator\">=</span>/usr/local/mpich-3.1/bin/mpicc ./configure --with-zlib<span class=\"token operator\">=</span>/home/user/study/software/zlib --prefix<span class=\"token operator\">=</span>/home/user/study/software/hdf5 --<span class=\"token punctuation\">&#123;</span>enable-fortran,disable-shared,enable-parallel<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">make</span> check <span class=\"token function\">install</span></pre></td></tr></table></figure><p>I just add  <code>[--&#123;enable-fortran,disable-shared,enable-parallel&#125;]</code>  from offical documentation of NEMO<sup>[1]</sup>, but it may bring some problems.</p>\n<h2 id=\"netcdf\"><a class=\"markdownIt-Anchor\" href=\"#netcdf\">#</a> netcdf</h2>\n<p>After HDF5 is done, build netcdf, specifying the location of the HDF5, zlib, and<br>\nlibraries in the CPPFLAGS and LDFLAGS environment variables. For example:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">CC</span><span class=\"token operator\">=</span>mpicc <span class=\"token assign-left variable\">CPPFLAGS</span><span class=\"token operator\">=</span>-I/home/user/study/software/hdf5/include <span class=\"token assign-left variable\">LDFLAGS</span><span class=\"token operator\">=</span>-L/home/user/study/software/hdf5/lib <span class=\"token assign-left variable\">LD_LIBRARY_PATH</span><span class=\"token operator\">=</span>/home/user/study/software/hdf5/lib:/home/user/study/software/zlib/lib ./configure --prefix<span class=\"token operator\">=</span>/home/user/study/software/netcdf-c-p --<span class=\"token punctuation\">&#123;</span>enable-fortran,disable-shared,enable-parallel,enable-parallel-tests<span class=\"token punctuation\">&#125;</span> --enable-netcdf4</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">make</span> check <span class=\"token function\">install</span></pre></td></tr></table></figure><p>You can check the output or setting file in  <code>lib</code>  to see whether parallel IO is on.</p>\n<p>Then build netcdf-fortran like:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">CC</span><span class=\"token operator\">=</span>mpicc <span class=\"token assign-left variable\">FC</span><span class=\"token operator\">=</span>mpif90 <span class=\"token assign-left variable\">F77</span><span class=\"token operator\">=</span>mpif77 <span class=\"token assign-left variable\">CPPFLAGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-I/home/user/study/software/netcdf-c-p/include -I/home/user/study/software/hdf5/include -I/home/user/study/software/zlib/include\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">LDFLAGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-L/home/user/study/software/netcdf-c-p/lib -L/home/user/study/software/hdf5/lib -L/home/user/study/software/zlib/lib\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">LD_LIBRARY_PATH</span><span class=\"token operator\">=</span>/home/user/study/software/netcdf-c-p/lib:/home/user/study/software/hdf5/lib:/home/user/study/software/zlib/lib <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">LIBS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-lnetcdf -lhdf5_hl -lhdf5 -lz -lcurl\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>./configure --disable-shared --prefix<span class=\"token operator\">=</span>/home/user/study/software/netcdf-f-p</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">make</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">make</span> check</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">make</span> <span class=\"token function\">install</span></pre></td></tr></table></figure><h2 id=\"ncview\"><a class=\"markdownIt-Anchor\" href=\"#ncview\">#</a> ncview</h2>\n<p>It is not necessary, but it’s a easy tool to check the nc file.</p>\n<p>First install Xaw using  <code>sudo yum install libXaw-devel</code> .<br>\nThen just following [6].</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./configure --prefix<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/ncview/ --with-udunits2_incdir<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/udunits/include/ --with-udunits2_libdir<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/udunits/lib/ --with-png_incdir<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/libpng/include/ --with-png_libdir<span class=\"token operator\">=</span><span class=\"token variable\">$&#123;<span class=\"token environment constant\">HOME</span>&#125;</span>/study/software/libpng/lib/</pre></td></tr></table></figure><h2 id=\"xios\"><a class=\"markdownIt-Anchor\" href=\"#xios\">#</a> XIOS</h2>\n<p>Refer to wiki<sup>[2]</sup> and J Mak’s notes<sup>[4]</sup>, first</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>svn checkout -r <span class=\"token number\">1566</span> http://forge.ipsl.jussieu.fr/ioserver/svn/XIOS/branchs/xios-2.5 xios-2.5</pre></td></tr></table></figure><p>NEMO has requirements for the XIOS version, remember to check that.</p>\n<p>Then modify files  <code>arch-GCC_LINUX.*</code>  in  <code>arch</code> , add the  <code>-ldl</code>  flag to  <code>HDF5_LIB</code>  in  <code>arch-GCC_local.path</code>  since we build hdf5 library as a not shareable.</p>\n<p>The  <code>boost_dir</code>  and  <code>OASIS_dir</code>  are not necessary, just leave them.</p>\n<p>Finally, run</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./make_xios --arch GCC_LINUX</pre></td></tr></table></figure><h1 id=\"nemo\"><a class=\"markdownIt-Anchor\" href=\"#nemo\">#</a> NEMO</h1>\n<p>Copy and rename an configuration file from an architecture similar to our own. Set the following variables:</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>%NCDF_HOME    &#x2F;usr&#x2F;local&#x2F;path&#x2F;to&#x2F;netcdf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>%HDF5_HOME    &#x2F;usr&#x2F;local&#x2F;path&#x2F;to&#x2F;hdf5</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>%XIOS_HOME    &#x2F;home&#x2F;$( whoami )&#x2F;path&#x2F;to&#x2F;xios-trunk</pre></td></tr></table></figure><p>Compile a reference configuration:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./makenemo –m <span class=\"token string\">'my_arch'</span> –r GYRE_PISCES</pre></td></tr></table></figure><p>And find  <code>nemo</code>  in  <code>cfgs/GYRE_PISCES/EXP00</code> .</p>\n<h1 id=\"good-luck\"><a class=\"markdownIt-Anchor\" href=\"#good-luck\">#</a> Good luck!</h1>\n<p>Hope you can find nemo soon.</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>._      ._      ._      ._      ._    </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  _.-._)&#96;\\_.-._)&#96;\\_.-._)&#96;\\_.-._)&#96;\\_.-._)&#96;\\_ </pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      o         _,           _,             </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        o      .&#39; (        .-&#39; &#x2F;             </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      o     _&#x2F;..._&#39;.    .&#39;   &#x2F;              </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  (    o .-&#39;&#96;      &#96; &#39;-.&#x2F;  _.&#39;               </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  )    ( o)           ;&#x3D; &lt;_         (       </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  (      &#39;-.,\\\\__ __.-;&#96;\\   &#39;.        )      </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  )  )       \\) |&#96;\\ \\)  &#39;.   \\      (   (   </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  (  (           \\_&#x2F;       &#39;-._\\      )   )  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  )  ) jgs                     &#96;    (   (   </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</pre></td></tr></table></figure><h1 id=\"reference\"><a class=\"markdownIt-Anchor\" href=\"#reference\">#</a> Reference</h1>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaXRlcy5uZW1vLW9jZWFuLmlvL3VzZXItZ3VpZGUvaW5zdGFsbC5odG1s\">NEMO documentation</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb3JnZS5pcHNsLmp1c3NpZXUuZnIvaW9zZXJ2ZXIvd2lraS9kb2N1bWVudGF0aW9u\">XIOS wiki</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaWNsb3VkLmNvbS9wcnRnLWt1bnBlbmdocGNzL2t1bnBlbmduZW1vXzAyXzAwMDEuaHRtbA==\">Kunpeng NEMO transplant</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZW1vLXJlbGF0ZWQucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2NvbXBpbGF0aW9uX25vdGVzL25lbW8zNi5odG1s\">J Mak NEMO notes</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96ZW5vZG8ub3JnL3JlY29yZC8zMzg2MzEwIy5ZbTEwNUpKQnhRSQ==\">NEMO Reference configurations inputs</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xNDcxMzM4\">NCVIEW installation</span></li>\n</ol>\n",
            "tags": [
                "Memo",
                "Coding"
            ]
        }
    ]
}